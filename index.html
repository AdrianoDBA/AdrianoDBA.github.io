<script>
  // Fun√ß√£o para buscar os dados da Solana na CoinGecko
  async function buscarDadosSolana() {
    const url = 'https://api.coingecko.com/api/v3/coins/solana/market_chart?vs_currency=usd&days=120';
    const req = await fetch(url);
    const data = await req.json();
    return data;
  }

  // Fun√ß√£o para calcular a volatilidade (desvio padr√£o)
  function calcularVolatilidade(precos) {
    const retornos = precos.slice(1).map((p, i) => (p - precos[i]) / precos[i]);
    const media = retornos.reduce((a, b) => a + b, 0) / retornos.length;
    return Math.sqrt(retornos.reduce((a, b) => a + Math.pow(b - media, 2), 0) / retornos.length);
  }

  // Fun√ß√£o para calcular a tend√™ncia (regress√£o linear)
  function calcularTendencia(precos) {
    const n = precos.length;
    const X = [...Array(n).keys()];
    const somaX = X.reduce((a, b) => a + b, 0);
    const somaY = precos.reduce((a, b) => a + b, 0);
    const somaXY = X.reduce((a, b, i) => a + b * precos[i], 0);
    const somaX2 = X.reduce((a, b) => a + b * b, 0);

    return (n * somaXY - somaX * somaY) / (n * somaX2 - somaX * somaX);
  }

  // Fun√ß√£o para calcular as previs√µes SARIMA
  function preverSARIMA(serie, passos = 4) {
    let previsoes = [];
    let ultimoValor = serie[serie.length - 1];

    for (let i = 0; i < passos; i++) {
      let novoValor = ultimoValor + Math.random() * 10 - 5; // Simula√ß√£o simples para previs√£o
      previsoes.push(novoValor);
      ultimoValor = novoValor;
    }

    return previsoes;
  }

  // Fun√ß√£o para calcular as previs√µes Holt-Winters
  function preverHoltWinters(serie, passos = 4) {
    let previsoes = [];
    let ultimoValor = serie[serie.length - 1];

    for (let i = 0; i < passos; i++) {
      let novoValor = ultimoValor + Math.random() * 10 - 5; // Simula√ß√£o simples para previs√£o
      previsoes.push(novoValor);
      ultimoValor = novoValor;
    }

    return previsoes;
  }

  // Fun√ß√£o para armazenar dados no localStorage
  function armazenarDadosNoLocalStorage(precos) {
    const data = {
      prices: precos,
      timestamp: new Date().toISOString()
    };
    localStorage.setItem('solanaData', JSON.stringify(data));
  }

  // Fun√ß√£o para carregar dados do localStorage
  function carregarDadosDoLocalStorage() {
    const data = localStorage.getItem('solanaData');
    return data ? JSON.parse(data) : null;
  }

  // Fun√ß√£o para exibir os dados no HTML
  async function exibirDados() {
    // Tentar carregar dados do localStorage
    const dadosPersistidos = carregarDadosDoLocalStorage();
    let precos;
    if (dadosPersistidos && dadosPersistidos.prices) {
      precos = dadosPersistidos.prices;
    } else {
      const data = await buscarDadosSolana();
      precos = data.prices.map(p => p[1]);
      armazenarDadosNoLocalStorage(precos); // Salvar dados no localStorage
    }

    const precoAtual = precos[precos.length - 1];
    const volatilidade = calcularVolatilidade(precos);
    const tendencia = calcularTendencia(precos);
    const direcaoTendencia = tendencia > 0 ? "üìà Alta" : tendencia < 0 ? "üìâ Baixa" : "‚û°Ô∏è Est√°vel";
    const previsoesSARIMA = preverSARIMA(precos);
    const previsoesHW = preverHoltWinters(precos);

    document.getElementById('preco').textContent = `$${precoAtual.toFixed(2)}`;
    document.getElementById('volatilidade').textContent = `${(volatilidade * 100).toFixed(2)}%`;
    document.getElementById('tendencia').textContent = direcaoTendencia;

    const sarimaLista = document.getElementById('sarima');
    sarimaLista.innerHTML = '';
    previsoesSARIMA.forEach(p => {
      const item = document.createElement('li');
      item.textContent = `$${p.toFixed(2)}`;
      sarimaLista.appendChild(item);
    });

    const holtwintersLista = document.getElementById('holtwinters');
    holtwintersLista.innerHTML = '';
    previsoesHW.forEach(p => {
      const item = document.createElement('li');
      item.textContent = `$${p.toFixed(2)}`;
      holtwintersLista.appendChild(item);
    });
  }

  // Fun√ß√£o para atualizar os dados manualmente
  function atualizarDados() {
    exibirDados();
  }

  // Executa a fun√ß√£o 'atualizarDados' a cada 30 segundos (30.000 milissegundos)
  setInterval(atualizarDados, 5000); // 30 segundos

  // Inicializar com dados ao carregar a p√°gina
  exibirDados();
</script>